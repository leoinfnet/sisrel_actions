name: CI com badge estático

on: [push]
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
        - name: Checkout
          uses: actions/checkout@v4

        - name: Setup Python
          uses: actions/setup-python@v5
          with:
              python-version: '3.11'

        - name: Instalar dependências
          run: |
              python -m pip install --upgrade pip
              pip install -r requirements.txt

        - name: Rodar testes com cobertura
          run: pytest -v --cov=sisrel --cov-report=xml:coverage.xml
        - name: Gerar Badge estatico de cobertura
          id: badge
          run: |
            COVERAGE=$(grep -oPm1 '(?<=line-rate=")[^"]+' coverage.xml)
            PERCENT=$(python -c "print(int(float('${COVERAGE}')*100))")

            echo "Cobertura: ${PERCENT} "

